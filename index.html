<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>ULTIMATE Mushroom Meme</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    html,body{margin:0;height:100%;overflow:hidden;background:#000;}
    /* Styles for individual mushrooms, applied dynamically */
    .shroom-instance {
      position:absolute;
      pointer-events:none; /* IMPORTANT: Allows clicks to pass through to the body */
      user-select: none; /* Prevent accidental text selection */
      will-change: transform; /* Optimize animation performance */
    }
    audio{display:none;} /* Keep audio element hidden */
  </style>
</head>
<body>
  <!-- The glorious clown music, loop it forever -->
  <audio id="clownAudio" src="clown.mp3" autoplay loop playsinline></audio>

  <script>
    const audio = document.getElementById('clownAudio');
    const shrooms = []; // Array to hold all active mushroom instances
    const mushroomImageSrc = 'mushroom_meme.png'; // Source for the mushroom image

    // Class to manage each individual mushroom's properties and behavior
    class Shroom {
      constructor(x, y) {
        // Create the image element
        this.element = document.createElement('img');
        this.element.src = mushroomImageSrc;
        this.element.alt = 'Mushroom Meme';
        this.element.className = 'shroom-instance';
        document.body.appendChild(this.element); // Add to the DOM

        // Randomize size (30vmin to 60vmin)
        this.size = Math.random() * (60 - 30) + 30;
        this.element.style.width = this.size + 'vmin';

        // Set initial position
        this.pos = { x: x, y: y };

        // Randomize velocity with a higher range for more erratic movement
        const speedMultiplier = (devicePixelRatio || 1) * (Math.random() * 3 + 1); // From 1x to 4x base speed
        this.vel = {
          x: (Math.random() * 2 - 1) * speedMultiplier, // -speed to +speed
          y: (Math.random() * 2 - 1) * speedMultiplier
        };

        // Randomize rotation speed and starting angle
        this.angle = Math.random() * 360;
        this.rotationSpeed = Math.random() * 5 + 1; // Faster and varied rotation

        // Randomize hue for a colorful, clownish look
        this.hue = Math.random() * 360;
        this.element.style.filter = `hue-rotate(${this.hue}deg)`;
      }

      // Update method for position and rotation
      update() {
        this.angle = (this.angle + this.rotationSpeed) % 360;
        this.pos.x += this.vel.x;
        this.pos.y += this.vel.y;

        // Get actual size in pixels to calculate accurate collision bounds
        // This accounts for `vmin` changing with window size
        const shroomWidth = this.element.offsetWidth;
        const shroomHeight = this.element.offsetHeight;

        // Bounce off edges of the viewport
        if (this.pos.x < shroomWidth / 2 || this.pos.x > innerWidth - shroomWidth / 2) {
          this.vel.x *= -1;
          // Nudge mushroom back into bounds to prevent sticking
          this.pos.x = Math.max(shroomWidth / 2, Math.min(this.pos.x, innerWidth - shroomWidth / 2));
        }
        if (this.pos.y < shroomHeight / 2 || this.pos.y > innerHeight - shroomHeight / 2) {
          this.vel.y *= -1;
          // Nudge mushroom back into bounds to prevent sticking
          this.pos.y = Math.max(shroomHeight / 2, Math.min(this.pos.y, innerHeight - shroomHeight / 2));
        }

        // Apply styles
        this.element.style.left = this.pos.x + 'px';
        this.element.style.top  = this.pos.y + 'px';
        this.element.style.transform = `translate(-50%, -50%) rotate(${this.angle}deg)`;
      }

      // Reposition on window resize to ensure mushrooms stay within the new bounds
      repositionOnResize() {
        const shroomWidth = this.element.offsetWidth;
        const shroomHeight = this.element.offsetHeight;
        this.pos.x = Math.min(Math.max(this.pos.x, shroomWidth / 2), innerWidth - shroomWidth / 2);
        this.pos.y = Math.min(Math.max(this.pos.y, shroomHeight / 2), innerHeight - shroomHeight / 2);
      }
    }

    // Function to create and add a new mushroom
    function createShroom(x, y) {
      const newShroom = new Shroom(x, y);
      shrooms.push(newShroom);
    }

    // The main animation loop
    function animate() {
      shrooms.forEach(shroom => shroom.update()); // Update all mushrooms
      requestAnimationFrame(animate); // Request next frame
    }

    // --- Initial Setup ---

    // Spawn a few mushrooms right away for instant chaos
    for (let i = 0; i < 5; i++) {
      createShroom(innerWidth / 2, innerHeight / 2); // Start them from the center
    }

    // Adjust mushroom positions when the window is resized (e.g., orientation change on mobile)
    addEventListener('resize', () => {
      shrooms.forEach(shroom => shroom.repositionOnResize());
    });

    // --- Audio Autoplay Handling (for browsers that block autoplay) ---
    let audioPlayedSuccessfully = false;
    const tryPlayAudio = () => {
      if (!audioPlayedSuccessfully) { // Only try if not already playing
        audio.play()
          .then(() => {
            audioPlayedSuccessfully = true; // Mark as played
            console.log("Audio started successfully!");
            // Optionally, remove these listeners if you only want the *first* interaction to trigger audio
            document.removeEventListener('pointerdown', tryPlayAudio);
            document.removeEventListener('keydown', tryPlayAudio);
          })
          .catch(error => {
            console.warn("Autoplay prevented:", error);
            // Audio didn't play, 'audioPlayedSuccessfully' remains false, so it will try again on next interaction
          });
      }
    };

    // If audio is initially paused (common for autoplay policies)
    if (audio.paused) {
      // Add listeners to attempt playback on any user interaction (click/tap or key press)
      document.addEventListener('pointerdown', tryPlayAudio, { once: true });
      document.addEventListener('keydown', tryPlayAudio, { once: true });
    } else {
      audioPlayedSuccessfully = true; // Audio is already playing (e.g., in a development environment)
    }

    // --- Interactive Mushroom Spawning ---
    // Spawn a new mushroom at the click/tap location
    // Since mushrooms have `pointer-events: none`, this listener on `document.body`
    // will always catch clicks, even if they visually land on a mushroom.
    document.body.addEventListener('pointerdown', (e) => {
      createShroom(e.clientX, e.clientY);
    });

    // Start the endless animation loop!
    animate();
  </script>
</body>
</html>
